<!DOCTYPE html>
<html lang="en">

<head>
    <title>After School Activities</title>
    <link rel="logo" type="image/png" href="../coursework1_M00791121/images/logo.png">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.js"></script>
    <script src="activities.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css"
        integrity="sha384-DyZ88mC6Up2uqS4h/KRgHuoeGwBcD4Ng9SiP4dIRy0EXTlnuz47vAwmeGwVChigm" crossorigin="anonymous" />
</head>

<body class="checkout">
    <div id="app">
        <header>
            <h1 v-text="sitename"></h1>
            <input type="text" v-model="search" placeholder="Search">
            <div class="sort">
                <label for="sortSelect">Sort by:</label>
                <select id="sortSelect" v-model="selectedSort" @change="sortProducts">
                    <option value="all">All</option>
                    <option value="title">Subject (Ascending)</option>
                    <option value="titleDesc">Subject (Descending)</option>
                    <option value="location">Location (Ascending)</option>
                    <option value="locationDesc">Location (Descending)</option>
                    <option value="availableInventory">Available Spaces</option>
                    <option value="priceLowtoHigh">Price: Low to High</option>
                    <option value="priceHightoLow">Price: High to Low</option>
                </select>
            </div>
            <button class="checkout-button" @click="showCheckout" :disabled="cart.length === 0">
                <span class="cart-icon fas fa-cart-plus"></span>
                Checkout ({{ cartItemCount }})
            </button>
        </header>
        <main>
            <div v-if="showActivity" class="activity-box">
                <div v-for="activity in sortedProducts" :key="activity.id" class="activity-item">
                    <figure>
                        <img v-bind:src="activity.image" alt="Activity Image">
                    </figure>
                    <div class="activity-details">
                        <h2 v-text="activity.title"></h2>
                        <p v-html="activity.location"></p>
                        <p class="activity-price">Price: AED {{ activity.price }}</p>
                        <div>
                            <span v-for="n in activity.rating">★</span>
                            <span v-for="n in 5 - activity.rating">☆</span>
                        </div>
                        <button @click="addToCart(activity)" :disabled="!canAddToCart(activity)"
                            :class="{ 'sold-out-button': !canAddToCart(activity) }" class="buy-button">
                            {{ canAddToCart(activity) ? 'Add to cart' : 'All out!' }}
                        </button>
                    </div>
                </div>
            </div>

            <div v-else>
                <div class="checkout-container">
                    <h2>Checkout</h2>
                    <p>
                        <strong>Name:</strong>
                        <input v-model.trim="order.name" pattern="[A-Za-z]+" title="Enter your full name:" required />
                    </p>
                    <p>
                        <strong>Number:</strong>
                        <input v-model.trim="order.number" pattern="[0-9]+" title="Enter your phone number:" required />
                    </p>
                    <button @click="submitForm" :disabled="!isFormValid" class="place-order-button">Place
                        Order!</button>
                </div>
              
            </div>
        </main>
    </div>

    <script type="text/javascript">
        let webstore = new Vue({
            el: "#app",
            data: {
                sitename: "After School Activities",
                showActivity: true,
                activities: activities,
                selectedSort: [],
                search: '',
                cart: [],
                sortedProducts: [],
                order: {
                    name: '',
                    number: ''
                }
            },
            methods: {
                sortProducts() {
                    let activitiesArray = this.activities.slice(0);

                    switch (this.selectedSort) {
                        case 'title':
                            activitiesArray.sort((a, b) => a.title.localeCompare(b.title));
                            break;
                        case 'titleDesc':
                            activitiesArray.sort((a, b) => b.title.localeCompare(a.title));
                            break;
                        case 'location':
                            activitiesArray.sort((a, b) => a.location.localeCompare(b.location));
                            break;
                        case 'locationDesc':
                            activitiesArray.sort((a, b) => b.location.localeCompare(a.location));
                            break;
                        case 'availableInventory':
                            activitiesArray.sort((a, b) => a.availableInventory - b.availableInventory);
                            break;
                        case 'priceLowtoHigh':
                            activitiesArray.sort((a, b) => a.price - b.price);
                            break;
                        case 'priceHightoLow':
                            activitiesArray.sort((a, b) => b.price - a.price);
                            break;
                        default:
                            break;
                    }

                    if (this.search.trim() !== '') {
                        activitiesArray = activitiesArray.filter(activity =>
                            activity.title.toLowerCase().includes(this.search.toLowerCase()) ||
                            activity.location.toLowerCase().includes(this.search.toLowerCase())
                        );
                    }
                    this.sortedProducts = activitiesArray;
                },
                addToCart: function (activity) {
                    if (this.canAddToCart(activity) && activity.availableInventory > 0) {
                        this.cart.push(activity.id);
                        activity.availableInventory--;
                    }
                },
                showCheckout() {
                    this.showActivity = !this.showActivity;
                },
                submitForm() {
                    alert('Order Submitted!');
                },
                canAddToCart: function (activity) {
                    return activity.availableInventory > 0;
                },
            },
            computed: {
                cartItemCount: function () {
                    return this.cart.length || '';
                },
                isFormValid: function () {
                    return this.order.name && this.order.number;
                }
            },
            created() {
                this.sortProducts();
            },
            watch: {
                search: 'sortProducts',
            },
        });
    </script>
</body>

</html>